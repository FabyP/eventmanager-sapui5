sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/Sorter","sap/ui/core/Fragment"],function(e,t,n,i,a,r){"use strict";return e.extend("ba.eventmanager-openui5.controller.Overview",{onInit:function(){var e=this.getOwnerComponent().getModel("eventData");e.dataLoaded().then(this.onJSONDataLoaded.bind(this));this.getView().setModel(e,"events")},onJSONDataLoaded:function(){var e=new t;this.getView().setModel(e,"viewModel");this.getView().getModel("viewModel").setProperty("/allEventsCount",this.getView().getModel("events").getData().Events.length);this.getView().getModel("viewModel").setProperty("/partyCount",this.filterPartyEvents(this.getView().getModel("events").getData().Events).length);this.getView().getModel("viewModel").setProperty("/familyCount",this.filterFamilyEvents(this.getView().getModel("events").getData().Events).length);this.getView().getModel("viewModel").setProperty("/marketCount",this.filterMarketEvents(this.getView().getModel("events").getData().Events).length);this.getView().getModel("viewModel").setProperty("/otherCount",this.filterOtherEvents(this.getView().getModel("events").getData().Events).length)},onAfterRendering:function(){setTimeout(function(){this.getView().byId("idIconTabBarNoIcons").getItems()[0].$().addClass("sapMITBSelected")}.bind(this),0)},filterPartyEvents:function(e){return e.filter(e=>e.category==="Party")},filterFamilyEvents:function(e){return e.filter(e=>e.category==="Familie")},filterMarketEvents:function(e){return e.filter(e=>e.category==="Markt")},filterOtherEvents:function(e){return e.filter(e=>e.category==="Sonstiges")},categorySelect:function(e){var t=e.getParameter("key");if(t==="All"){this.getView().byId("eventsTable").getBinding("items").filter([])}else{var n=new sap.ui.model.Filter("category",i.Contains,t);this.getView().byId("eventsTable").getBinding("items").filter([n])}sap.ui.getCore().byId(e.getParameter("id")).$().removeClass("sapMITBSelected");e.getParameter("selectedItem").$().addClass("sapMITBSelected")},onFilterEvents:function(e){var t=[];var a=e.getSource().getValue();if(a&&a.length>0){t.push(new n("name",i.Contains,a))}var r=this.getView().byId("eventsTable");var o=r.getBinding("items");o.filter(t)},toDate:function(e){var t=e.split(".");var n=new Date(t[2],t[1]-1,t[0]);return n},onSortDesc:function(e){var t=[];var n="date";var i=true;var r=false;var o=function(e,t){var n=this.toDate(e);var i=this.toDate(t);if(i==null){return-1}if(n==null){return 1}if(n<i){return-1}if(n>i){return 1}return 0}.bind(this);t.push(new a(n,i,r,o));this.getView().byId("eventsTable").getBinding("items").sort(t)},onSortAsc:function(e){var t=[];var n="date";var i=false;var r=false;var o=function(e,t){var n=this.toDate(e);var i=this.toDate(t);if(i==null){return-1}if(n==null){return 1}if(n<i){return-1}if(n>i){return 1}return 0}.bind(this);t.push(new a(n,i,r,o));this.getView().byId("eventsTable").getBinding("items").sort(t)},goToDetail:function(e){var t=e.getSource();var n=sap.ui.core.UIComponent.getRouterFor(this);var i=t.getBindingContextPath().split("/")[2];n.navTo("Detail",{eventKey:i})},onAdd:function(){this._getDialog()},_getDialog:function(){var e=this.getView();if(!this.byId("addEventDialog")){r.load({id:e.getId(),name:"ba.eventmanager-openui5.view.AddEventDialog",controller:this}).then(function(t){e.addDependent(t);t.open()})}else{this.byId("addEventDialog").open()}},onClose:function(){this.byId("addEventDialog").close()},onCreateEvent:function(){var e=this.getView();var t=e.getModel("eventData");var n=e.byId("nameInput").getValue();var i=e.byId("dateInput").getValue();var a=e.byId("timeInput").getValue();var r=e.byId("locationInput").getValue();var o=e.byId("descriptionInput").getValue();var s=e.byId("categoryInput").getSelectedItem().getText();var l=e.byId("imgInput").getValue();var d=e.byId("altInput").getValue();var g=e.byId("hostInput").getValue();t.setData({Events:[{name:n,date:i,time:a,location:r,img:l,alt:d,description:o,host:g,category:s}]},true);e.byId("addEventDialog").close()},onMyPress:function(){alert("okay")}})});