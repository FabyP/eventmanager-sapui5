/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/base/util/isEmptyObject","sap/ui/core/Component","sap/ui/core/Element","sap/ui/core/Shortcut"],function(e,t,n,i,a){"use strict";var r=i.extend("sap.ui.core.CommandExecution",{metadata:{library:"sap.ui.core",properties:{command:{type:"string"},enabled:{type:"boolean",defaultValue:true}},events:{execute:{}}},trigger:function(){if(this.getEnabled()){this.fireExecute({})}},setCommand:function(t){if(!this.getCommand()){this.setProperty("command",t,true)}else{e.error("The 'command' property can only be applied initially!")}return this},_getCommandInfo:function(){var e,t=this.getParent(),i=n.getOwnerComponentFor(this);while(!i&&t&&t.getParent()){i=n.getOwnerComponentFor(t);t=t.getParent()}if(i){e=i.getCommand(this.getCommand())}return e?Object.assign({},e):null},_createCommandData:function(e){var t=this.getParent(),n=t.getBindingContext("$cmd"),i=t.getModel("$cmd"),a=i.getData(),r=a[t.getId()];if(!r){e=n&&n.getObject();r=Object.create(e||null)}else if(e&&e!==Object.getPrototypeOf(r)){r=Object.create(e)}else if(r[this.getCommand()]){return}r[this.getCommand()]={};r[this.getCommand()].enabled=this.getEnabled();i.setProperty("/"+t.getId(),r);this.bindProperty("enabled",{path:"$cmd>"+this.getCommand()+"/enabled"});t.bindElement("$cmd>/"+t.getId())},setParent:function(e){var t=this,n,r=this.getParent(),o,s;i.prototype.setParent.apply(this,arguments);n=this._getCommandInfo();function g(){if(e.getModel("$cmd")){t._createCommandData();t.getParent().detachModelContextChange(g)}}if(n){if(e&&e!==r){o=n.shortcut;s=a.isRegistered(this.getParent(),o);if(!s){a.register(e,o,this.trigger.bind(this))}if(e.getModel("$cmd")){this._createCommandData()}else{e.attachModelContextChange(g)}var d=e._propagateProperties;e._propagateProperties=function(){var n=e.oPropagatedProperties;var i=n.oBindingContexts["$cmd"];var a=t.getBindingContext("$cmd");if(i&&a&&i!==a){t._createCommandData(i.getObject())}d.apply(e,arguments)};e._propagateProperties._sapui_fnOrig=d}if(r&&r!=e){o=n.shortcut;s=a.isRegistered(r,o);if(s){a.unregister(r,n.shortcut)}this._cleanupContext(r)}}return this},_cleanupContext:function(e){if(e.getBindingContext("$cmd")){var n=e.getBindingContext("$cmd").getObject();if(n){delete n[this.getCommand()]}if(t(Object.assign({},n))){e._propagateProperties=e._propagateProperties._sapui_fnOrig;e.unbindElement("$cmd")}}},destroy:function(){var e=this.getParent();if(e){var t=this._getCommandInfo();a.unregister(this.getParent(),t.shortcut);this._cleanupContext(e)}i.prototype.destroy.apply(this,arguments)}});r.find=function(e,t){var n,i,a;a=e.getDependents();for(n=0;n<a.length;n++){if(a[n].isA("sap.ui.core.CommandExecution")&&a[n].getCommand()===t){i=a[n]}}if(!i&&e.getParent()){i=r.find(e.getParent(),t)}return i};return r});